(import $sqrt as $native_sqrt from math.sqrt)

(const %SOME_CONST 123)

(func $fake_sqrt
  (push u8 1)
  (push i8 -1)
  (push u8 0xFF)
  (push i16 0xFF)
  (push u8 21)
  (push u8 %SOME_CONST)
  (add u8)
  (sub u16)
  (mul u8)
  (div u8)
  (add i16)
  (if (< i16)
    (sub i16)
    (mul i16)
    (if (> i16)
      (sub i16)
      (mul i16)
      (div i16)
    (else
      (sub i16)
      (mul i16)
      (if (> i16)
        (sub i16)
        (mul i16)
        (div i16)
      (else
        (sub i16)
        (mul i16)
        (div i16)))
      (div i16)))
    (div i16)
  (else
    (sub i16)
    (mul i16)
    (div i16)))
  (shr i16)
  (while (! i16)
    (mul i8)
    (mul i8)
    (while (= i16)
      (push u8 23)
      (push u8 23)
      (if (> i16)
        (sub i16)
        (mul i16)
        (if (> i16)
          (sub i16)
          (mul i16)
          (div i16)
        (else
          (sub i16)
          (mul i16)
          (if (> i16)
            (sub i16)
            (mul i16)
            (div i16)
          (else
            (sub i16)
            (mul i16)
            (div i16)))
          (div i16)))
        (div i16)
      (else
        (sub i16)
        (mul i16)
        (div i16)))
      (add u8))
    (mul i8)
    (mul i8))
  (shl i16)
  (and i16)
  (or i16)
  (xor i16)
  (not i16)
  (neg i16)
  (neg i16)
  (inc i16)
  (dec i16)
  (u8_promote)
  (u16_demote)
  (i8_promote)
  (i16_demote)
  (reg :sp)
  (reg :bp)
  (load u8 0x0003)
  (load u8)
  (store u8 0x0003)
  (store u8)
  (dup u8)
  (drop u8)
  (call $native_sqrt)
  (ret)
  (sys :nuke)
  (call $native_sqrt)
  (alloc 6)
  (free))

(func $main
  (call $fake_sqrt))
